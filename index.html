<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OREN PREMIUM PRO</title>
    <style>
        :root { 
            --bg: #e0e5ec; 
            --p: #6e48aa; 
            --a: #00d2ff;
            --shadow: 9px 9px 16px rgb(163,177,198,0.6), -9px -9px 16px rgba(255,255,255, 0.5);
            --inner: inset 6px 6px 12px #b8bec5, inset -6px -6px 12px #ffffff;
        }
        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; transition: 0.3s; }
        body { margin: 0; background: var(--bg); color: #444; overflow-x: hidden; }

        /* Splash Screen */
        #splash { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #050510; display: flex; justify-content: center; align-items: center; z-index: 9999; }
        .energy-ball { width: 15px; height: 15px; background: #fff; border-radius: 50%; box-shadow: 0 0 20px var(--a); animation: dropAndShock 1.5s forwards; }
        @keyframes dropAndShock { 0% { transform: translateY(-800px); } 65% { transform: translateY(0); box-shadow: 0 0 150px 70px rgba(0, 210, 255, 0.6); } 100% { transform: scale(60); opacity: 0; } }

        /* Containers */
        .container { display: none; padding: 15px; max-width: 500px; margin: auto; }
        .active { display: block !important; }

        /* Neumorphism Cards */
        .glass-card { background: var(--bg); border-radius: 30px; box-shadow: var(--shadow); padding: 25px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.2); }
        .input-box { width: 100%; padding: 15px; margin-bottom: 15px; border-radius: 15px; border: none; background: var(--bg); box-shadow: var(--inner); outline: none; text-align: center; font-size: 16px; }
        .btn { width: 100%; padding: 15px; border-radius: 15px; border: none; background: var(--bg); box-shadow: var(--shadow); color: var(--p); font-weight: 900; cursor: pointer; font-size: 16px; }
        .btn:active { box-shadow: var(--inner); transform: scale(0.98); }

        /* Stats */
        .stats-bar { display: flex; gap: 10px; margin-bottom: 20px; }
        .stat-item { flex: 1; background: var(--bg); box-shadow: var(--inner); padding: 10px; border-radius: 15px; text-align: center; }
        .stat-item b { display: block; font-size: 20px; color: var(--p); }

        /* Logs */
        .log-card { background: var(--bg); box-shadow: var(--shadow); border-radius: 20px; padding: 15px; margin-bottom: 15px; border-right: 5px solid #00b09b; animation: slideIn 0.4s ease; }
        .log-header { display: flex; justify-content: space-between; font-size: 10px; border-bottom: 1px dashed #ccc; padding-bottom: 5px; margin-bottom: 8px; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
    </style>
</head>
<body>

    <div id="splash"><div class="energy-ball"></div></div>

    <div id="authPage" class="container active" style="padding-top: 80px; text-align: center;">
        <h1 style="color: var(--p); font-size: 45px; margin-bottom: 5px;">OREN</h1>
        <p style="opacity: 0.6; margin-bottom: 30px;">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨</p>
        <div class="glass-card">
            <input type="email" id="lEmail" class="input-box" placeholder="Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„">
            <input type="password" id="lPass" class="input-box" placeholder="Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯">
            <button class="btn" onclick="login()">Ø¯Ø®ÙˆÙ„ ğŸ”“</button>
            <p onclick="showAdmin()" style="margin-top:20px; font-size:12px; cursor:pointer; color: var(--p);">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±</p>
        </div>
    </div>

    <div id="dashboard" class="container">
        <div class="glass-card" style="display: flex; justify-content: space-between; align-items: center; padding: 15px 20px;">
            <b>Ø£Ù‡Ù„Ø§Ù‹: <span id="uName" style="color:var(--p)">...</span></b>
            <button onclick="logout()" style="border:none; background:none; color:red; font-weight:bold;">Ø®Ø±ÙˆØ¬</button>
        </div>
        <div class="stats-bar">
            <div class="stat-item">Ø¨Ø§Ù‚ÙŠ<b id="uWait">0</b></div>
            <div class="stat-item">ØªÙ…<b id="uDone">0</b></div>
        </div>
        <div id="taskCard" class="glass-card">
            <h3 id="cName" style="margin:0 0 15px 0; color: var(--p);">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ù‡Ø§Ù…...</h3>
            <div style="text-align: right; font-size: 14px;">
                <p>ğŸ“ <b>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</b> <span id="cAddr">--</span></p>
                <p>ğŸ“ <b>ØªÙ„ÙŠÙÙˆÙ†:</b> <span id="cPhone">--</span></p>
                <p>ğŸ“ <b>Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:</b> <span id="cDesc">--</span></p>
            </div>
            <textarea id="vReport" class="input-box" style="height:100px; text-align:right;" placeholder="Ø§ÙƒØªØ¨ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø²ÙŠØ§Ø±Ø© Ù‡Ù†Ø§..."></textarea>
            <button class="btn" onclick="finishTask()" style="background: var(--p); color: white;">Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø© âœ…</button>
        </div>
    </div>

    <div id="adminPanel" class="container">
        <div class="glass-card">
            <h2 style="color:var(--p); margin-top:0;">Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© ğŸ¯</h2>
            <input type="text" id="mUid" class="input-box" placeholder="UID Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨">
            <input type="text" id="mClient" class="input-box" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
            <input type="text" id="mAddress" class="input-box" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†">
            <input type="text" id="mPhone" class="input-box" placeholder="ØªÙ„ÙŠÙÙˆÙ† Ø§Ù„Ø¹Ù…ÙŠÙ„">
            <textarea id="mDesc" class="input-box" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ù‡Ù…Ø©"></textarea>
            <button class="btn" onclick="sendTask()">Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø·Ø§Ø¨ÙˆØ± ğŸš€</button>
        </div>
        <h2 style="text-align:center; color:var(--p);">Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ù„Ø­Ø¸ÙŠ ğŸ“‹</h2>
        <div id="logsContainer"></div>
        <button class="btn" onclick="location.reload()" style="margin-top:20px; color:red;">Ø±Ø¬ÙˆØ¹</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, push, set, onValue, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyALgV2v3lmxvEoP0HosqGSqm727vZrYUq4",
            authDomain: "orenapp-f2f1e.firebaseapp.com",
            databaseURL: "https://orenapp-f2f1e-default-rtdb.firebaseio.com",
            projectId: "orenapp-f2f1e",
            storageBucket: "orenapp-f2f1e.firebasestorage.app",
            messagingSenderId: "973368909449",
            appId: "1:973368909449:web:ce364a309f622f575c3058"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        let userUid = null;
        let currentTaskId = null;

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ (Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø±ÙŠÙØ±ÙŠØ´)
        onAuthStateChanged(auth, (user) => {
            if (user) {
                userUid = user.uid;
                showSection('dashboard');
                loadUserData();
            } else { showSection('authPage'); }
            setTimeout(() => { document.getElementById('splash').style.display = 'none'; }, 1500);
        });

        window.login = () => {
            const e = document.getElementById('lEmail').value;
            const p = document.getElementById('lPass').value;
            signInWithEmailAndPassword(auth, e, p).catch(() => alert("Ø¨ÙŠØ§Ù†Ø§Øª ØºÙ„Ø· ÙŠØ§ Ø¨Ø·Ù„"));
        };

        window.logout = () => signOut(auth);

        window.showAdmin = () => {
            if(prompt("ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ù…Ø¯ÙŠØ±:") === "123456") {
                showSection('adminPanel');
                loadAdminLogs();
            }
        };

        function showSection(id) {
            document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        // Ø¥Ø±Ø³Ø§Ù„ Ù…Ù‡Ù…Ø© (Ù„Ù„Ù…Ø¯ÙŠØ±)
        window.sendTask = async () => {
            const uid = document.getElementById('mUid').value.trim();
            if(!uid) return alert("ÙÙŠÙ† Ø§Ù„Ù€ UIDØŸ");
            try {
                const newTask = push(ref(db, 'tasks/' + uid));
                await set(newTask, {
                    client: document.getElementById('mClient').value,
                    address: document.getElementById('mAddress').value,
                    phone: document.getElementById('mPhone').value,
                    desc: document.getElementById('mDesc').value,
                    status: "pending",
                    time: new Date().toLocaleString('ar-EG')
                });
                alert("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø·Ø§Ø¨ÙˆØ± âœ…");
                ["mClient", "mAddress", "mPhone", "mDesc"].forEach(i => document.getElementById(i).value = "");
            } catch(e) { alert("ÙØ´Ù„: " + e.message); }
        };

        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨
        function loadUserData() {
            onValue(ref(db, 'tasks/' + userUid), (snap) => {
                const tasks = snap.val();
                let pending = tasks ? Object.keys(tasks).filter(k => tasks[k].status === "pending").sort() : [];
                document.getElementById('uWait').innerText = pending.length;
                if(pending.length > 0) {
                    currentTaskId = pending[0];
                    const t = tasks[currentTaskId];
                    document.getElementById('cName').innerText = t.client;
                    document.getElementById('cAddr').innerText = t.address;
                    document.getElementById('cPhone').innerText = t.phone;
                    document.getElementById('cDesc').innerText = t.desc;
                    document.getElementById('uName').innerText = "Ù…Ù†Ø¯ÙˆØ¨ " + userUid.substring(0,4);
                } else {
                    document.getElementById('cName').innerText = "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ø­Ø§Ù„ÙŠØ§Ù‹";
                    ["cAddr", "cPhone", "cDesc"].forEach(i => document.getElementById(i).innerText = "--");
                }
            });
            onValue(ref(db, 'history/' + userUid), snap => {
                document.getElementById('uDone').innerText = snap.exists() ? Object.keys(snap.val()).length : 0;
            });
        }

        // Ø¥Ù†Ù‡Ø§Ø¡ Ù…Ù‡Ù…Ø© (Ù„Ù„Ù…Ù†Ø¯ÙˆØ¨)
        window.finishTask = async () => {
            const report = document.getElementById('vReport').value;
            if(!report) return alert("Ø§ÙƒØªØ¨ Ø§Ù„ØªÙ‚Ø±ÙŠØ±!");
            const hRef = push(ref(db, 'history/' + userUid));
            await set(hRef, { 
                client: document.getElementById('cName').innerText, 
                report, 
                time: new Date().toLocaleString('ar-EG') 
            });
            await update(ref(db, 'tasks/' + userUid + '/' + currentTaskId), { status: "completed" });
            document.getElementById('vReport').value = "";
            alert("ØªÙ… Ø§Ù„ØªÙ‚ÙÙŠÙ„ ÙˆØ³Ø­Ø¨ Ø§Ù„ØªØ§Ù„ÙŠØ©! ğŸš€");
        };

        // Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¯ÙŠØ± (Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­ÙŠØ©)
        function loadAdminLogs() {
            onValue(ref(db, 'history'), (snap) => {
                const container = document.getElementById('logsContainer');
                container.innerHTML = "";
                const data = snap.val();
                if(!data) return container.innerHTML = "<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ø´Ø§Ø·</p>";
                Object.keys(data).forEach(uid => {
                    Object.keys(data[uid]).forEach(logId => {
                        const log = data[uid][logId];
                        const card = document.createElement('div');
                        card.className = 'log-card';
                        card.innerHTML = `
                            <div class="log-header"><b>ğŸ‘¤ Ù…Ù†Ø¯ÙˆØ¨: ${uid.substring(0,5)}</b> <span>â° ${log.time}</span></div>
                            <p style="margin:5px 0"><b>Ø§Ù„Ø¹Ù…ÙŠÙ„:</b> ${log.client}</p>
                            <p style="margin:0; font-size:13px; opacity:0.8"><b>Ø§Ù„ØªÙ‚Ø±ÙŠØ±:</b> ${log.report}</p>`;
                        container.prepend(card);
                    });
                });
            });
        }
    </script>
</body>
</html>
