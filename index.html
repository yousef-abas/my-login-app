<!DOCTYPE html>
<html lang="ar" dir="rtl" id="mainHtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OREN - Professional System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <style>
        :root { --primary-color: #1a73e8; --bg-color: #f0f2f5; --card-bg: #ffffff; --text-color: #333; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--bg-color); margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        .top-bar { width: 100%; padding: 10px 20px; display: flex; justify-content: space-between; box-sizing: border-box; background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .lang-btn { background: var(--primary-color); color: white; border: none; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-weight: bold; }
        .container { background: var(--card-bg); padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 90%; max-width: 450px; margin: 30px 0; }
        h2 { text-align: center; color: var(--primary-color); margin-bottom: 25px; }
        .input-group { margin-bottom: 15px; position: relative; }
        label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 14px; color: #555; }
        input, select, textarea { width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; outline: none; transition: 0.3s; font-family: inherit; }
        input:focus, select:focus { border-color: var(--primary-color); box-shadow: 0 0 5px rgba(26,115,232,0.2); }
        .main-btn { width: 100%; padding: 12px; background: var(--primary-color); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .main-btn:active { transform: scale(0.98); }
        .task-card { background: #fff; border-right: 5px solid var(--primary-color); padding: 15px; border-radius: 10px; box-shadow: 0 3px 10px rgba(0,0,0,0.05); margin-bottom: 15px; position: relative; }
        .hidden { display: none; }
        .logout-btn { background: #ea4335; color: white; border: none; padding: 5px 12px; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

    <div class="top-bar">
        <div id="userInfo" class="hidden"><b id="userEmailDisp"></b> <button class="logout-btn" onclick="logout()">Ø®Ø±ÙˆØ¬</button></div>
        <button class="lang-btn" onclick="toggleLanguage()" id="langToggle">English</button>
    </div>

    <div class="container" id="loginForm">
        <h2 id="loginTitle">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù†Ø¸Ø§Ù…</h2>
        <div class="input-group">
            <label id="lblUser">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
            <input type="email" id="email" placeholder="admin@oren.com">
        </div>
        <div class="input-group">
            <label id="lblPass">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
            <input type="password" id="pass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
        </div>
        <button class="main-btn" id="btnLogin" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
    </div>

    <div class="container hidden" id="adminForm">
        <h2 id="adminTitle">Ù„ÙˆØ­Ø© ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù…</h2>
        <div class="input-group">
            <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
            <input type="text" id="custName">
        </div>
        <div class="input-group">
            <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
            <input type="tel" id="custPhone">
        </div>
        <div class="input-group">
            <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
            <input type="text" id="custAddr">
        </div>
        <div class="input-group">
            <label>ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</label>
            <textarea id="custIssue" rows="3"></textarea>
        </div>
        <div class="input-group">
            <label>Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø§Ù„Ù…Ø³Ø¦ÙˆÙ„</label>
            <select id="agentSelect">
                <option value="">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨...</option>
            </select>
        </div>
        <button class="main-btn" onclick="assignTask()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ø¢Ù†</button>
    </div>

    <div class="container hidden" id="agentForm">
        <h2 id="agentTitle">Ù…Ù‡Ø§Ù…ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
        <div id="tasksList"></div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyALgV2v3lmxvEoP0HosqGSqm727vZrYUq4",
            authDomain: "orenapp-f2f1e.firebaseapp.com",
            databaseURL: "https://orenapp-f2f1e-default-rtdb.firebaseio.com",
            projectId: "orenapp-f2f1e",
            storageBucket: "orenapp-f2f1e.firebasestorage.app",
            messagingSenderId: "973368909449",
            appId: "1:973368909449:web:ce364a309f622f575c3058"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function login() {
            const e = document.getElementById('email').value;
            const p = document.getElementById('pass').value;
            firebase.auth().signInWithEmailAndPassword(e, p).catch(err => alert("Ø®Ø·Ø£: " + err.message));
        }

        firebase.auth().onAuthStateChanged(user => {
            const loginF = document.getElementById('loginForm');
            const adminF = document.getElementById('adminForm');
            const agentF = document.getElementById('agentForm');
            const uInfo = document.getElementById('userInfo');

            if (user) {
                loginF.classList.add('hidden');
                uInfo.classList.remove('hidden');
                document.getElementById('userEmailDisp').innerText = user.email;

                if (user.email === "admin@oren.com") {
                    adminF.classList.remove('hidden');
                    loadAgents();
                } else {
                    agentF.classList.remove('hidden');
                    const agentName = user.email.split('@')[0];
                    db.ref('active_agents/' + agentName).set({name: agentName});
                    loadAgentTasks(agentName);
                }
            } else {
                loginF.classList.remove('hidden');
                adminF.classList.add('hidden');
                agentF.classList.add('hidden');
                uInfo.classList.add('hidden');
            }
        });

        function loadAgents() {
            db.ref('active_agents').on('value', snap => {
                const s = document.getElementById('agentSelect');
                s.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ --</option>';
                snap.forEach(c => s.innerHTML += `<option value="${c.val().name}">${c.val().name}</option>`);
            });
        }

        function assignTask() {
            const agent = document.getElementById('agentSelect').value;
            if(!agent) return alert("Ø¨Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù†Ø¯ÙˆØ¨");
            db.ref('tasks_final_version').push({
                customer: document.getElementById('custName').value,
                phone: document.getElementById('custPhone').value,
                addr: document.getElementById('custAddr').value,
                issue: document.getElementById('custIssue').value,
                to: agent
            }).then(() => {
                alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©");
                document.getElementById('custName').value = "";
            });
        }

        function loadAgentTasks(name) {
            db.ref('tasks_final_version').on('value', snap => {
                const list = document.getElementById('tasksList');
                list.innerHTML = "";
                snap.forEach(c => {
                    const t = c.val();
                    if(t.to === name) {
                        list.innerHTML += `
                            <div class="task-card">
                                <b>ğŸ‘¤ Ø§Ù„Ø¹Ù…ÙŠÙ„: ${t.customer}</b><br>
                                ğŸ“ ${t.phone} | ğŸ“ ${t.addr}<br>
                                ğŸ“ ${t.issue}<br>
                                <button class="main-btn" style="padding:8px; font-size:13px" onclick="finish('${c.key}')">ØªÙ… Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² âœ…</button>
                            </div>`;
                    }
                });
            });
        }

        function finish(id) { db.ref('tasks_final_version/' + id).remove(); }
        function logout() { firebase.auth().signOut(); }

        // Ù†Ø¸Ø§Ù… Ø§Ù„Ù„ØºØ© (ÙƒÙ…Ø§ ÙÙŠ ÙƒÙˆØ¯Ùƒ)
        let currentLang = 'ar';
        function toggleLanguage() {
            const html = document.getElementById('mainHtml');
            const btn = document.getElementById('langToggle');
            if (currentLang === 'ar') {
                html.dir = 'ltr'; currentLang = 'en'; btn.innerText = 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©'; updateText('en');
            } else {
                html.dir = 'rtl'; currentLang = 'ar'; btn.innerText = 'English'; updateText('ar');
            }
        }
        function updateText(lang) {
            const trans = {
                ar: { loginTitle: "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù†Ø¸Ø§Ù…", lblUser: "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ", lblPass: "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±", btnLogin: "Ø¯Ø®ÙˆÙ„", adminTitle: "Ù„ÙˆØ­Ø© ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù…", agentTitle: "Ù…Ù‡Ø§Ù…ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠØ©" },
                en: { loginTitle: "System Login", lblUser: "Email Address", lblPass: "Password", btnLogin: "Login", adminTitle: "Task Distribution", agentTitle: "My Current Tasks" }
            };
            document.getElementById('loginTitle').innerText = trans[lang].loginTitle;
            document.getElementById('lblUser').innerText = trans[lang].lblUser;
            document.getElementById('lblPass').innerText = trans[lang].lblPass;
            document.getElementById('btnLogin').innerText = trans[lang].btnLogin;
            document.getElementById('adminTitle').innerText = trans[lang].adminTitle;
            document.getElementById('agentTitle').innerText = trans[lang].agentTitle;
        }
    </script>
</body>
</html>
