<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OREN PRO - Logistics</title>
    <style>
        :root { --p: #9d50bb; --s: #6e48aa; --a: #00d2ff; --bg: #050510; --shadow: rgba(0, 210, 255, 0.3); }
        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        body { margin: 0; background: var(--bg); color: white; min-height: 100vh; overflow-x: hidden; }

        /* Splash Screen Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠ */
        #splash { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); display: flex; justify-content: center; align-items: center; z-index: 9999; }
        .energy-ball { width: 15px; height: 15px; background: #fff; border-radius: 50%; box-shadow: 0 0 20px var(--a); animation: dropAndShock 1.5s forwards; position: absolute; }
        .oren-reveal { font-size: 60px; font-weight: 900; opacity: 0; animation: textReveal 1.2s 1.4s forwards; letter-spacing: 8px; background: linear-gradient(to right, #fff, var(--a)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        @keyframes dropAndShock { 0% { transform: translateY(-800px); } 65% { transform: translateY(0); box-shadow: 0 0 150px 70px rgba(0, 210, 255, 0.6); } 100% { transform: scale(60); opacity: 0; } }
        @keyframes textReveal { 0% { opacity: 0; filter: blur(20px); transform: scale(0.8); } 100% { opacity: 1; filter: blur(0); transform: scale(1); } }

        /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¨Ø±ÙˆØ²Ø© */
        .auth-card { background: rgba(255,255,255,0.03); backdrop-filter: blur(20px); padding: 40px 30px; border-radius: 35px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 20px 50px rgba(0,0,0,0.5); width: 90%; max-width: 400px; margin: 100px auto; text-align: center; }
        .input-box { width: 100%; padding: 15px; margin-bottom: 15px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: white; text-align: center; outline: none; }
        .input-box:focus { transform: scale(1.05); border-color: var(--a); box-shadow: 0 0 15px var(--shadow); }
        .btn { width: 100%; padding: 18px; border-radius: 15px; border: none; background: linear-gradient(45deg, var(--s), var(--p)); color: white; font-weight: bold; cursor: pointer; font-size: 16px; box-shadow: 0 10px 20px rgba(0,0,0,0.3); }
        .btn:hover { transform: translateY(-5px); box-shadow: 0 15px 30px var(--p); }

        /* Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø§Ù„Ø´ÙŠÙƒ */
        #dashboard { display: none; padding: 20px; }
        .user-bar { display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.05); padding: 15px 20px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 25px; }
        .counter-badge { background: var(--a); color: var(--bg); padding: 5px 15px; border-radius: 12px; font-weight: 900; box-shadow: 0 0 15px var(--a); }

        /* Ø§Ù„ÙƒØ§Ø±Øª "Ø§Ù„Ø±ÙŠÙƒÙˆÙŠØ³Øª" Ø§Ù„Ù…Ù„ÙƒÙŠ */
        .request-card { background: linear-gradient(145deg, rgba(255,255,255,0.1), rgba(255,255,255,0.02)); border-radius: 30px; padding: 25px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 25px 45px rgba(0,0,0,0.4); margin-bottom: 25px; }
        .request-header { color: var(--a); font-size: 12px; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 10px; display: block; }
        .client-name { font-size: 28px; font-weight: 900; margin-bottom: 15px; display: block; }
        
        .detail-item { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 18px; margin-bottom: 10px; border-right: 4px solid var(--p); }
        .detail-label { font-size: 11px; opacity: 0.6; display: block; margin-bottom: 3px; }
        .detail-val { font-size: 15px; font-weight: 600; }

        .report-area { width: 100%; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 15px; color: white; margin-bottom: 20px; height: 100px; resize: none; }
    </style>
</head>
<body>

    <div id="splash"><div class="energy-ball"></div><div class="oren-reveal">OREN PRO</div></div>

    <div id="authPage">
        <div class="auth-card">
            <h1 style="color: var(--a); margin-bottom: 10px;">OREN</h1>
            <p style="opacity: 0.6; margin-bottom: 30px;">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠØ©</p>
            <input type="email" id="lEmail" class="input-box" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
            <input type="password" id="lPass" class="input-box" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            <button class="btn" onclick="login()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… ğŸ”</button>
            <p onclick="showAdmin()" style="margin-top: 20px; font-size: 11px; cursor: pointer; opacity: 0.4;">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±</p>
        </div>
    </div>

    <div id="dashboard" class="container">
        <div class="user-bar">
            <div>
                <span style="display: block; font-size: 11px; opacity: 0.6;">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</span>
                <b id="uName" style="font-size: 18px;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</b>
            </div>
            <div class="counter-badge">
                <span style="font-size: 10px;">Ø§Ù†Ø¬Ø²Øª:</span> <span id="uCount">0</span>
            </div>
        </div>

        <div id="taskContent">
            <div class="request-card">
                <span class="request-header">Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© âš¡</span>
                <span class="client-name" id="cName">Ø§Ù†ØªØ¸Ø± Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</span>
                
                <div class="detail-item">
                    <span class="detail-label">ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„:</span>
                    <span class="detail-val" id="cAddr">--</span>
                </div>

                <div class="detail-item">
                    <span class="detail-label">ğŸ“ Ø±Ù‚Ù… ØªÙ„ÙŠÙÙˆÙ† Ø§Ù„Ø¹Ù…ÙŠÙ„:</span>
                    <span class="detail-val" id="cPhone">--</span>
                </div>

                <div class="detail-item">
                    <span class="detail-label">ğŸ“ ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© / Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:</span>
                    <span class="detail-val" id="cDesc">--</span>
                </div>
            </div>

            <div id="actionArea">
                <textarea id="visitReport" class="report-area" placeholder="Ø§ÙƒØªØ¨ ØªÙ‚Ø±ÙŠØ±Ùƒ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù‡Ù†Ø§ Ù‚Ø¨Ù„ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚..."></textarea>
                <button class="btn" onclick="completeVisit()" style="background: linear-gradient(45deg, #00b09b, #96c93d);">Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø© ÙˆØªØ³Ù„ÙŠÙ… Ø§Ù„ØªÙ‚Ø±ÙŠØ± âœ…</button>
            </div>
        </div>
    </div>

    <div id="adminPanel" style="display:none; padding: 20px;">
        <div class="auth-card" style="margin-top: 50px;">
            <h2 style="color: var(--a);">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù… ğŸ¯</h2>
            <input type="text" id="mUid" class="input-box" placeholder="UID Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨">
            <input type="text" id="mClient" class="input-box" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
            <input type="text" id="mAddress" class="input-box" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„">
            <input type="text" id="mPhone" class="input-box" placeholder="Ø±Ù‚Ù… Ø§Ù„ØªÙ„ÙŠÙÙˆÙ†">
            <textarea id="mDesc" class="input-box" style="height:80px" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© / Ø§Ù„Ù…Ø·Ù„ÙˆØ¨"></textarea>
            <button class="btn" onclick="sendTask()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø© ÙÙˆØ±Ø§Ù‹</button>
            <button onclick="location.reload()" style="background:none; border:none; color:red; margin-top:15px;">Ø®Ø±ÙˆØ¬</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, set, get, update, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyALgV2v3lmxvEoP0HosqGSqm727vZrYUq4",
            authDomain: "orenapp-f2f1e.firebaseapp.com",
            databaseURL: "https://orenapp-f2f1e-default-rtdb.firebaseio.com",
            projectId: "orenapp-f2f1e",
            storageBucket: "orenapp-f2f1e.firebasestorage.app",
            messagingSenderId: "973368909449",
            appId: "1:973368909449:web:ce364a309f622f575c3058"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        let currentUser = null;

        window.login = async () => {
            const email = document.getElementById('lEmail').value;
            const pass = document.getElementById('lPass').value;
            try {
                const res = await signInWithEmailAndPassword(auth, email, pass);
                currentUser = res.user;
                startApp();
            } catch (err) { alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©"); }
        };

        window.showAdmin = () => {
            if(prompt("ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ù…Ø¯ÙŠØ±:") === "123456") {
                document.getElementById('authPage').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
            }
        };

        function startApp() {
            document.getElementById('authPage').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            
            // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…Ù‡Ø§Ù… Ù„Ø­Ø¸ÙŠØ§Ù‹ (Real-time)
            onValue(ref(db, 'tasks/' + currentUser.uid), (snapshot) => {
                const data = snapshot.val();
                if (data && data.active) {
                    document.getElementById('cName').innerText = data.client;
                    document.getElementById('cAddr').innerText = data.address;
                    document.getElementById('cPhone').innerText = data.phone;
                    document.getElementById('cDesc').innerText = data.desc;
                    document.getElementById('actionArea').style.display = 'block';
                } else {
                    document.getElementById('cName').innerText = "ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ù…Ù‡Ù…Ø©...";
                    document.getElementById('cAddr').innerText = "--";
                    document.getElementById('cPhone').innerText = "--";
                    document.getElementById('cDesc').innerText = "--";
                    document.getElementById('actionArea').style.display = 'none';
                }
            });

            // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯
            onValue(ref(db, 'history/' + currentUser.uid), (snapshot) => {
                const count = snapshot.exists() ? Object.keys(snapshot.val()).length : 0;
                document.getElementById('uCount').innerText = count;
            });
        }

        window.completeVisit = async () => {
            const report = document.getElementById('visitReport').value;
            if(!report) return alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø§ÙƒØªØ¨ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø²ÙŠØ§Ø±Ø©");

            const updateData = {};
            updateData['tasks/' + currentUser.uid + '/active'] = false;
            
            const historyKey = Date.now();
            await update(ref(db), {
                ['history/' + currentUser.uid + '/' + historyKey]: {
                    client: document.getElementById('cName').innerText,
                    report: report,
                    time: new Date().toLocaleString('ar-EG')
                },
                ['tasks/' + currentUser.uid + '/active']: false
            });

            document.getElementById('visitReport').value = "";
            alert("ØªÙ… ØªØ³Ù„ÙŠÙ… Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­");
        };

        window.sendTask = async () => {
            const uid = document.getElementById('mUid').value;
            if(!uid) return alert("Ø£Ø¯Ø®Ù„ UID Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨");
            await set(ref(db, 'tasks/' + uid), {
                client: document.getElementById('mClient').value,
                address: document.getElementById('mAddress').value,
                phone: document.getElementById('mPhone').value,
                desc: document.getElementById('mDesc').value,
                active: true
            });
            alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±ÙŠÙƒÙˆÙŠØ³Øª Ù„Ù„Ù…Ù†Ø¯ÙˆØ¨ âœ…");
        };

        window.onload = () => {
            setTimeout(() => {
                document.getElementById('splash').style.opacity = '0';
                setTimeout(() => document.getElementById('splash').style.display = 'none', 800);
            }, 3000);
        };
    </script>
</body>
</html>
