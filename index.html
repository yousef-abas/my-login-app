<!DOCTYPE html>
<html lang="ar" dir="rtl" id="mainHtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OREN - Professional System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <style>
        :root { 
            --primary-color: #1a73e8; 
            --bg-color: #f0f2f5; 
            --card-bg: #ffffff; 
            --neon-purple: #9d85ff;
        }

        /* --- Ø´Ø§Ø´Ø© Ø§Ù„Ø§ÙØªØªØ§Ø­ÙŠØ© Ø§Ù„Ø³ÙˆØ¯Ø© (Ø§Ù„Ù„ÙŠ Ø¥Ù†Øª Ø¨ØªØ­Ø¨Ù‡Ø§) --- */
        #splash {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 10000; transition: 1s ease-in-out;
        }
        .neon-text {
            font-size: 70px; font-weight: 900; color: #fff;
            animation: neonPulse 1.5s ease-in-out infinite alternate;
        }
        @keyframes neonPulse {
            from { text-shadow: 0 0 10px #fff, 0 0 20px var(--neon-purple); opacity: 1; }
            to { text-shadow: 0 0 5px #fff, 0 0 10px var(--neon-purple); opacity: 0.4; }
        }

        /* --- Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø£Ø¨ÙŠØ¶ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ --- */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--bg-color); margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        .top-bar { width: 100%; padding: 10px 20px; display: flex; justify-content: space-between; box-sizing: border-box; background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .lang-btn { background: var(--primary-color); color: white; border: none; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-weight: bold; }
        .container { background: var(--card-bg); padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 90%; max-width: 450px; margin: 30px 0; }
        h2 { text-align: center; color: var(--primary-color); margin-bottom: 25px; }
        .input-group { margin-bottom: 15px; position: relative; }
        label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 14px; color: #555; }
        input, select, textarea { width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; outline: none; transition: 0.3s; }
        .main-btn { width: 100%; padding: 12px; background: var(--primary-color); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .task-card { background: #fff; border-right: 5px solid var(--primary-color); padding: 15px; border-radius: 10px; box-shadow: 0 3px 10px rgba(0,0,0,0.05); margin-bottom: 15px; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="splash">
        <div class="neon-text">OREN</div>
        <p style="color: #666; letter-spacing: 5px; margin-top: 10px;">PREMIUM EDITION</p>
    </div>

    <div class="top-bar">
        <div id="userInfo" class="hidden">
            <b id="userEmailDisp" style="font-size: 12px; color: #666;"></b> 
            <button onclick="logout()" style="border:none; background:none; color:red; cursor:pointer; font-weight:bold;">Ø®Ø±ÙˆØ¬</button>
        </div>
        <button class="lang-btn" onclick="toggleLanguage()" id="langToggle">English</button>
    </div>

    <div class="container" id="loginForm">
        <h2 id="loginTitle">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
        <div class="input-group">
            <label id="lblUser">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
            <input type="email" id="email" placeholder="example@oren.com">
        </div>
        <div class="input-group">
            <label id="lblPass">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
            <input type="password" id="pass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
        </div>
        <button class="main-btn" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
    </div>

    <div class="container hidden" id="adminForm">
        <h2 id="adminTitle">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ± ğŸ‘‘</h2>
        <div class="input-group">
            <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
            <input type="text" id="custName">
        </div>
        <div class="input-group">
            <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
            <input type="tel" id="custPhone">
        </div>
        <div class="input-group">
            <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
            <input type="text" id="custAddr">
        </div>
        <div class="input-group">
            <label>Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</label>
            <textarea id="custIssue" rows="2"></textarea>
        </div>
        <div class="input-group">
            <label>Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</label>
            <select id="agentSelect"><option value="">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</option></select>
        </div>
        <button class="main-btn" onclick="assignTask()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø© Ù„Ù„Ù…Ù†Ø¯ÙˆØ¨</button>
    </div>

    <div class="container hidden" id="agentForm">
        <h2 id="agentTitle">Ù…Ù‡Ø§Ù…ÙŠ</h2>
        <div id="tasksList"></div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyALgV2v3lmxvEoP0HosqGSqm727vZrYUq4",
            authDomain: "orenapp-f2f1e.firebaseapp.com",
            databaseURL: "https://orenapp-f2f1e-default-rtdb.firebaseio.com",
            projectId: "orenapp-f2f1e",
            storageBucket: "orenapp-f2f1e.firebasestorage.app",
            messagingSenderId: "973368909449",
            appId: "1:973368909449:web:ce364a309f622f575c3058"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù€ Splash
        setTimeout(() => { 
            document.getElementById('splash').style.opacity = '0';
            setTimeout(() => document.getElementById('splash').style.display = 'none', 1000);
        }, 3000);

        function login() {
            const e = document.getElementById('email').value;
            const p = document.getElementById('pass').value;
            firebase.auth().signInWithEmailAndPassword(e, p).catch(err => alert(err.message));
        }

        firebase.auth().onAuthStateChanged(user => {
            const loginF = document.getElementById('loginForm'), adminF = document.getElementById('adminForm');
            const agentF = document.getElementById('agentForm'), uInfo = document.getElementById('userInfo');
            if (user) {
                loginF.classList.add('hidden'); uInfo.classList.remove('hidden');
                document.getElementById('userEmailDisp').innerText = user.email;
                if (user.email === "admin@oren.com") { adminF.classList.remove('hidden'); loadAgents(); }
                else { 
                    agentF.classList.remove('hidden'); 
                    const n = user.email.split('@')[0];
                    db.ref('active_agents/' + n).set({name: n});
                    loadAgentTasks(n);
                }
            } else {
                loginF.classList.remove('hidden'); adminF.classList.add('hidden');
                agentF.classList.add('hidden'); uInfo.classList.add('hidden');
            }
        });

        function loadAgents() {
            db.ref('active_agents').on('value', snap => {
                const s = document.getElementById('agentSelect');
                s.innerHTML = '<option value="">-- Ø§Ø®ØªØ± --</option>';
                snap.forEach(c => s.innerHTML += `<option value="${c.val().name}">${c.val().name}</option>`);
            });
        }

        function assignTask() {
            const ag = document.getElementById('agentSelect').value;
            if(!ag) return alert("Ø§Ø®ØªØ§Ø± Ù…Ù†Ø¯ÙˆØ¨");
            db.ref('tasks_final').push({
                customer: document.getElementById('custName').value,
                phone: document.getElementById('custPhone').value,
                addr: document.getElementById('custAddr').value,
                issue: document.getElementById('custIssue').value,
                to: ag
            }).then(() => { alert("ØªÙ…!"); document.getElementById('custName').value = ""; });
        }

        function loadAgentTasks(name) {
            db.ref('tasks_final').on('value', snap => {
                const list = document.getElementById('tasksList');
                list.innerHTML = "";
                snap.forEach(c => {
                    const t = c.val();
                    if(t.to === name) {
                        list.innerHTML += `<div class="task-card">
                            <b>ğŸ‘¤ ${t.customer}</b><br>ğŸ“ ${t.phone}<br>ğŸ“ ${t.addr}<br>ğŸ“ ${t.issue}<br>
                            <button class="main-btn" style="padding:5px; font-size:12px;" onclick="finish('${c.key}')">ØªÙ… âœ…</button>
                        </div>`;
                    }
                });
            });
        }

        function finish(id) { db.ref('tasks_final/' + id).remove(); }
        function logout() { firebase.auth().signOut(); }

        let currentLang = 'ar';
        function toggleLanguage() {
            const html = document.getElementById('mainHtml'), btn = document.getElementById('langToggle');
            if (currentLang === 'ar') {
                html.dir = 'ltr'; currentLang = 'en'; btn.innerText = 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©';
            } else {
                html.dir = 'rtl'; currentLang = 'ar'; btn.innerText = 'English';
            }
        }
    </script>
</body>
</html>
