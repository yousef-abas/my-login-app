<!DOCTYPE html>
<html lang="ar" dir="rtl" id="mainHtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oren - Ø£ÙˆØ±ÙŠÙ†</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap');

        * { box-sizing: border-box; transition: all 0.3s ease; font-family: 'Poppins', sans-serif; }
        
        body {
            margin: 0;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .logo-text {
            font-size: 45px; font-weight: 800; letter-spacing: 3px;
            background: linear-gradient(to right, #00d2ff, #928dab);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin-bottom: 10px; text-transform: uppercase;
        }

        .container {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px);
            padding: 40px;
            border-radius: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 420px;
            text-align: center;
            color: white;
        }

        .lang-switch { position: absolute; top: 25px; left: 25px; }
        .lang-btn {
            background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
            color: white; padding: 6px 18px; border-radius: 12px; cursor: pointer; font-size: 13px;
        }

        .input-group { margin-bottom: 18px; text-align: right; }
        html[dir="ltr"] .input-group { text-align: left; }

        label { display: block; margin-bottom: 8px; font-size: 13px; color: #00d2ff; font-weight: 600; }

        input, select, textarea {
            width: 100%; padding: 14px 20px; border: 1px solid rgba(255,255,255,0.2);
            border-radius: 15px; font-size: 15px; background: rgba(255,255,255,0.05);
            color: white; outline: none; font-family: inherit;
        }
        input:focus, select:focus { border-color: #00d2ff; background: rgba(255,255,255,0.1); }
        option { background: #302b63; color: white; }

        .main-btn {
            width: 100%; padding: 16px; background: linear-gradient(to right, #00d2ff, #3a7bd5);
            border: none; border-radius: 15px; color: white; font-size: 16px;
            font-weight: 600; cursor: pointer; margin-top: 10px;
            box-shadow: 0 10px 20px rgba(0, 210, 255, 0.2);
        }
        .main-btn:hover { transform: translateY(-3px); box-shadow: 0 15px 25px rgba(0, 210, 255, 0.3); }

        /* ÙƒØ±ÙˆØª Ø§Ù„Ù…Ù‡Ø§Ù… Ù„Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨ */
        .task-card {
            background: rgba(255, 255, 255, 0.05);
            border-left: 4px solid #00d2ff;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 15px;
            text-align: right;
        }
        html[dir="ltr"] .task-card { text-align: left; border-left: none; border-right: 4px solid #00d2ff; }

        .hidden { display: none; }
        ::placeholder { color: rgba(255,255,255,0.3); }

        .user-badge { font-size: 12px; background: rgba(0, 210, 255, 0.2); padding: 5px 12px; border-radius: 20px; margin-bottom: 20px; display: inline-block; }
    </style>
</head>
<body>

    <div class="lang-switch">
        <button class="lang-btn" onclick="toggleLanguage()" id="langToggle">English</button>
    </div>

    <div class="container" id="loginScreen">
        <div class="logo-text">OREN</div>
        <h2 id="loginTitle" style="font-weight: 300; margin-bottom: 30px;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù†Ø¸Ø§Ù…</h2>
        
        <div class="input-group">
            <input type="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" id="emailInput">
        </div>
        <div class="input-group">
            <input type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" id="passInput">
        </div>
        
        <button class="main-btn" onclick="login()">Ø¯Ø®ÙˆÙ„</button>

        <div style="margin-top: 20px; font-size: 12px; color: #aaa;">
            Ù†Ø¸Ø§Ù… Ø£ÙˆØ±ÙŠÙ† Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙƒÙ„ÙŠÙØ§Øª Ø§Ù„Ø°ÙƒÙŠØ©
        </div>
    </div>

    <div class="container hidden" id="adminScreen">
        <div class="logo-text" style="font-size: 30px;">ADMIN PANEL</div>
        <div class="user-badge">Ø§Ù„Ù…Ø¯ÙŠØ± ÙŠÙˆØ³Ù ğŸ‘‘</div>
        
        <div class="input-group">
            <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
            <input type="text" id="cName">
        </div>
        <div class="input-group">
            <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
            <input type="tel" id="cPhone">
        </div>
        <div class="input-group">
            <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„</label>
            <input type="text" id="cAddr">
        </div>
        <div class="input-group">
            <label>ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</label>
            <textarea id="cIssue" rows="2" style="width: 100%; border-radius: 15px; background: rgba(255,255,255,0.05); color: white; border: 1px solid rgba(255,255,255,0.2); padding: 10px; outline: none;"></textarea>
        </div>
        <div class="input-group">
            <label>Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</label>
            <select id="agentSelect">
                <option value="">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨...</option>
            </select>
        </div>
        
        <button class="main-btn" onclick="assignTask()">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ø¢Ù†</button>
        <button onclick="logout()" style="background:none; border:none; color:#ff4757; cursor:pointer; margin-top:15px; font-weight:bold;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </div>

    <div class="container hidden" id="agentScreen">
        <div class="logo-text" style="font-size: 30px;">OREN TASKS</div>
        <div class="user-badge">Ø£Ù‡Ù„Ø§Ù‹: <span id="agentDisplayName"></span> ğŸ‘‹</div>
        
        <div id="tasksList" style="margin-top: 20px;">
            </div>

        <button class="main-btn" style="background: #57606f;" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
    </div>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyALgV2v3lmxvEoP0HosqGSqm727vZrYUq4",
            authDomain: "orenapp-f2f1e.firebaseapp.com",
            databaseURL: "https://orenapp-f2f1e-default-rtdb.firebaseio.com",
            projectId: "orenapp-f2f1e",
            storageBucket: "orenapp-f2f1e.firebasestorage.app",
            messagingSenderId: "973368909449",
            appId: "1:973368909449:web:ce364a309f622f575c3058"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        function login() {
            const e = document.getElementById('emailInput').value;
            const p = document.getElementById('passInput').value;
            firebase.auth().signInWithEmailAndPassword(e, p).catch(err => alert(err.message));
        }

        firebase.auth().onAuthStateChanged(user => {
            const loginS = document.getElementById('loginScreen');
            const adminS = document.getElementById('adminScreen');
            const agentS = document.getElementById('agentScreen');

            if (user) {
                loginS.classList.add('hidden');
                if (user.email === "admin@oren.com") {
                    adminS.classList.remove('hidden');
                    loadAgentsList();
                } else {
                    agentS.classList.remove('hidden');
                    const name = user.email.split('@')[0];
                    document.getElementById('agentDisplayName').innerText = name;
                    db.ref('active_agents/' + name).set({name: name});
                    loadAgentTasks(name);
                }
            } else {
                loginS.classList.remove('hidden');
                adminS.classList.add('hidden');
                agentS.classList.add('hidden');
            }
        });

        // Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø¯ÙŠØ±
        function loadAgentsList() {
            db.ref('active_agents').on('value', snap => {
                const select = document.getElementById('agentSelect');
                select.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ --</option>';
                snap.forEach(child => {
                    select.innerHTML += `<option value="${child.val().name}">${child.val().name}</option>`;
                });
            });
        }

        function assignTask() {
            const agent = document.getElementById('agentSelect').value;
            if(!agent) return alert("Ø¨Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù†Ø¯ÙˆØ¨!");
            
            db.ref('tasks_v5').push({
                customer: document.getElementById('cName').value,
                phone: document.getElementById('cPhone').value,
                addr: document.getElementById('cAddr').value,
                issue: document.getElementById('cIssue').value,
                to: agent
            }).then(() => {
                alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­ âœ…");
                document.getElementById('cName').value = "";
                document.getElementById('cPhone').value = "";
                document.getElementById('cAddr').value = "";
                document.getElementById('cIssue').value = "";
            });
        }

        // Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨
        function loadAgentTasks(name) {
            db.ref('tasks_v5').on('value', snap => {
                const list = document.getElementById('tasksList');
                list.innerHTML = "";
                snap.forEach(child => {
                    const task = child.val();
                    if(task.to === name) {
                        list.innerHTML += `
                            <div class="task-card">
                                <div style="color:#00d2ff; font-weight:bold; margin-bottom:5px;">ğŸ‘¤ ${task.customer}</div>
                                <div style="font-size:14px;">ğŸ“ ${task.phone}</div>
                                <div style="font-size:14px; opacity:0.8;">ğŸ“ ${task.addr}</div>
                                <div style="font-size:14px; margin-top:8px; border-top:1px solid rgba(255,255,255,0.1); padding-top:5px;">ğŸ“ ${task.issue}</div>
                                <button onclick="finishTask('${child.key}')" style="margin-top:10px; width:100%; padding:8px; border-radius:10px; border:none; background:#2ed573; color:white; cursor:pointer;">ØªÙ… Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² âœ…</button>
                            </div>
                        `;
                    }
                });
            });
        }

        function finishTask(id) { db.ref('tasks_v5/' + id).remove(); }
        function logout() { firebase.auth().signOut(); }

        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ©
        let currentLang = 'ar';
        function toggleLanguage() {
            const html = document.getElementById('mainHtml');
            const btn = document.getElementById('langToggle');
            currentLang = currentLang === 'ar' ? 'en' : 'ar';
            html.dir = currentLang === 'ar' ? 'rtl' : 'ltr';
            btn.innerText = currentLang === 'ar' ? 'English' : 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©';
            // ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© ØªØ±Ø¬Ù…Ø§Øª Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ù‡Ù†Ø§ Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª
        }
    </script>
</body>
</html>
