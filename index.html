<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OREN PREMIUM</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

    <style>
        :root {
            --bg: #e0e5ec;
            --main-purple: #6c5ce7;
            --shadow: 9px 9px 16px rgba(163,177,198,0.6), -9px -9px 16px rgba(255,255,255, 0.5);
            --inner: inset 6px 6px 12px #c1c9d7, inset -6px -6px 12px #ffffff;
        }

        body { font-family: 'Cairo', sans-serif; background: var(--bg); margin: 0; overflow-x: hidden; }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø§ÙØªØªØ§Ø­ÙŠØ© */
        #splash-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--main-purple); display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 1000; transition: 0.8s;
        }
        .loader-logo { font-size: 50px; color: white; font-weight: 900; letter-spacing: 5px; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        .container { max-width: 450px; margin: auto; padding: 20px; }

        /* ÙƒØ±ÙˆØª Ø¨Ù†ÙØ³Ø¬ÙŠØ© Ø¨Ø§Ø±Ø²Ø© */
        .glass-card {
            background: var(--bg); border-radius: 30px; padding: 25px;
            box-shadow: var(--shadow); margin-bottom: 25px; border: 1px solid rgba(255,255,255,0.3);
        }

        h2, h3 { color: var(--main-purple); text-align: center; font-weight: 900; }

        input, select, textarea {
            width: 100%; padding: 15px; margin: 10px 0; border: none; border-radius: 20px;
            background: var(--bg); box-shadow: var(--inner); font-family: 'Cairo';
            outline: none; color: #444; font-weight: 700; box-sizing: border-box;
        }

        button {
            width: 100%; padding: 18px; background: var(--main-purple); color: white;
            border: none; border-radius: 20px; font-weight: 900; font-size: 18px;
            box-shadow: 0 10px 20px rgba(108, 92, 231, 0.3); cursor: pointer; transition: 0.3s;
        }
        button:active { transform: scale(0.95); box-shadow: none; }

        .task-card {
            background: #fff; padding: 15px; border-radius: 20px; margin-bottom: 15px;
            border-right: 8px solid var(--main-purple); box-shadow: var(--shadow);
        }

        .hidden { display: none; }
        .label { font-size: 13px; color: var(--main-purple); font-weight: 900; margin-right: 10px; }
    </style>
</head>
<body>

<div id="splash-screen">
    <div class="loader-logo">OREN</div>
    <p style="color: white; font-weight: 600;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…...</p>
</div>

<div class="container">
    <div id="login-section" class="glass-card hidden">
        <h2>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</h2>
        <input type="email" id="login-email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
        <input type="password" id="login-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        <button onclick="login()">Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø³ÙŠØ³ØªÙ…</button>
    </div>

    <div id="admin-section" class="hidden">
        <div class="glass-card" style="display: flex; justify-content: space-between; align-items: center;">
            <h3 style="margin:0">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ± ğŸ‘‘</h3>
            <button onclick="logout()" style="width:auto; padding:5px 15px; font-size:12px; background:#ff4757;">Ø®Ø±ÙˆØ¬</button>
        </div>

        <div class="glass-card">
            <h3>ØªÙˆØ²ÙŠØ¹ Ù…Ù‡Ø§Ù… ğŸ“</h3>
            <span class="label">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</span><input type="text" id="c-name">
            <span class="label">Ø±Ù‚Ù… Ø§Ù„ØªÙ„ÙŠÙÙˆÙ†</span><input type="tel" id="c-phone">
            <span class="label">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</span><input type="text" id="c-addr">
            <span class="label">Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</span><textarea id="c-issue"></textarea>
            <span class="label">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</span>
            <select id="agents-list"><option value="">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨...</option></select>
            <button onclick="sendTask()">Ø¥Ø³Ù†Ø§Ø¯ Ø§Ù„Ù…Ù‡Ù…Ø© ÙÙˆØ±Ø§Ù‹</button>
        </div>
    </div>

    <div id="agent-section" class="hidden">
        <div class="glass-card">
            <h3>Ø£Ù‡Ù„Ø§Ù‹ <span id="agent-display-name"></span> ğŸ‘‹</h3>
            <button onclick="logout()" style="background:#ff4757;">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
        </div>
        <div id="tasks-container">
            </div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyALgV2v3lmxvEoP0HosqGSqm727vZrYUq4",
        authDomain: "orenapp-f2f1e.firebaseapp.com",
        databaseURL: "https://orenapp-f2f1e-default-rtdb.firebaseio.com",
        projectId: "orenapp-f2f1e",
        storageBucket: "orenapp-f2f1e.firebasestorage.app",
        messagingSenderId: "973368909449",
        appId: "1:973368909449:web:ce364a309f622f575c3058"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù€ Splash Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ†
    setTimeout(() => { document.getElementById('splash-screen').style.opacity = '0'; 
    setTimeout(() => document.getElementById('splash-screen').style.display = 'none', 800); }, 2000);

    function login() {
        const e = document.getElementById('login-email').value;
        const p = document.getElementById('login-pass').value;
        firebase.auth().signInWithEmailAndPassword(e, p).catch(err => alert(err.message));
    }

    firebase.auth().onAuthStateChanged(user => {
        if (user) {
            document.getElementById('login-section').classList.add('hidden');
            if(user.email === "admin@oren.com") {
                document.getElementById('admin-section').classList.remove('hidden');
                loadAgents();
            } else {
                document.getElementById('agent-section').classList.remove('hidden');
                const name = user.email.split('@')[0];
                document.getElementById('agent-display-name').innerText = name;
                db.ref('active_agents/' + name).set({name: name});
                loadMyTasks(name);
            }
        } else {
            document.getElementById('login-section').classList.remove('hidden');
            document.getElementById('admin-section').classList.add('hidden');
            document.getElementById('agent-section').classList.add('hidden');
        }
    });

    function loadAgents() {
        db.ref('active_agents').on('value', snap => {
            const sel = document.getElementById('agents-list');
            sel.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ --</option>';
            snap.forEach(c => sel.innerHTML += `<option value="${c.val().name}">${c.val().name}</option>`);
        });
    }

    function sendTask() {
        const agent = document.getElementById('agents-list').value;
        if(!agent) return alert("Ø§Ø®ØªØ§Ø± Ù…Ù†Ø¯ÙˆØ¨!");
        db.ref('new_tasks').push({
            customer: document.getElementById('c-name').value,
            phone: document.getElementById('c-phone').value,
            addr: document.getElementById('c-addr').value,
            issue: document.getElementById('c-issue').value,
            assignedTo: agent,
            status: "Ø¬Ø¯ÙŠØ¯"
        }).then(() => alert("ØªÙ… Ø§Ù„ØªÙƒÙ„ÙŠÙ!"));
    }

    function loadMyTasks(name) {
        db.ref('new_tasks').on('value', snap => {
            const container = document.getElementById('tasks-container');
            container.innerHTML = "<h3>Ù…Ù‡Ø§Ù…Ùƒ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h3>";
            snap.forEach(c => {
                const t = c.val();
                if(t.assignedTo === name) {
                    container.innerHTML += `
                        <div class="task-card">
                            <b style="color:var(--main-purple)">ğŸ‘¤ Ø§Ù„Ø¹Ù…ÙŠÙ„: ${t.customer}</b><br>
                            ğŸ“ ${t.phone}<br>ğŸ“ ${t.addr}<br>ğŸ“ ${t.issue}<br>
                            <button onclick="done('${c.key}')" style="padding:10px; font-size:14px; margin-top:10px;">ØªÙ… Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² âœ…</button>
                        </div>`;
                }
            });
        });
    }

    function done(key) { db.ref('new_tasks/' + key).remove(); }
    function logout() { firebase.auth().signOut(); }
</script>
</body>
</html>
