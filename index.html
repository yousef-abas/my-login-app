<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OREN PREMIUM - Field Operations</title>
    <style>
        :root { 
            --bg: #e0e5ec; /* Ù„ÙˆÙ† Ù†Ø§Ø¹Ù… Ø¹Ø´Ø§Ù† Ø§Ù„Ø¨Ø±ÙˆØ² ÙŠØ¨Ø§Ù† */
            --p: #6e48aa; 
            --a: #00d2ff;
            --shadow: 9px 9px 16px rgb(163,177,198,0.6), -9px -9px 16px rgba(255,255,255, 0.5);
            --inner-shadow: inset 6px 6px 12px #b8bec5, inset -6px -6px 12px #ffffff;
        }
        * { box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; transition: 0.4s ease; }
        body { margin: 0; background: var(--bg); color: #444; min-height: 100vh; display: flex; flex-direction: column; }

        /* Splash Screen */
        #splash { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #050510; display: flex; justify-content: center; align-items: center; z-index: 9999; }
        .oren-reveal { font-size: 50px; font-weight: 900; color: #fff; letter-spacing: 5px; text-shadow: 0 0 20px var(--a); animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 0.5; transform: scale(0.9); } 50% { opacity: 1; transform: scale(1); } 100% { opacity: 0.5; transform: scale(0.9); } }

        /* Ø§Ù„Ø£ÙˆØ¹ÙŠØ© Ø§Ù„Ø¨Ø§Ø±Ø²Ø© */
        .glass-card { background: var(--bg); border-radius: 30px; box-shadow: var(--shadow); padding: 25px; margin: 15px; border: 1px solid rgba(255,255,255,0.2); }
        
        /* ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        #authPage { display: none; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
        .input-box { width: 100%; padding: 15px; margin-bottom: 20px; border-radius: 15px; border: none; background: var(--bg); box-shadow: var(--inner-shadow); outline: none; text-align: center; font-size: 16px; color: #333; }
        .btn { width: 100%; padding: 15px; border-radius: 15px; border: none; background: var(--bg); box-shadow: var(--shadow); color: var(--p); font-weight: 900; cursor: pointer; font-size: 17px; }
        .btn:active { box-shadow: var(--inner-shadow); transform: scale(0.98); }

        /* Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ */
        #dashboard { display: none; padding: 10px; }
        .top-bar { display: flex; justify-content: space-between; align-items: center; }
        .user-info b { color: var(--p); font-size: 20px; }
        
        /* Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .stat-item { text-align: center; padding: 15px; border-radius: 20px; box-shadow: var(--shadow); }
        .stat-num { display: block; font-size: 24px; font-weight: 900; color: var(--p); }
        .stat-label { font-size: 11px; font-weight: bold; opacity: 0.7; }

        /* ÙƒØ§Ø±Øª Ø§Ù„Ù…Ù‡Ù…Ø© */
        .task-card { background: var(--bg); box-shadow: var(--shadow); border-radius: 25px; padding: 20px; position: relative; }
        .task-tag { position: absolute; top: -10px; left: 20px; background: var(--p); color: white; padding: 5px 15px; border-radius: 10px; font-size: 12px; box-shadow: 0 5px 10px rgba(110, 72, 170, 0.3); }
        .client-name { font-size: 22px; font-weight: 900; margin: 15px 0; color: #333; display: block; }
        
        .info-row { background: var(--bg); box-shadow: var(--inner-shadow); padding: 12px; border-radius: 15px; margin-bottom: 12px; font-size: 14px; }
        .info-row b { color: var(--p); }

        .report-area { width: 100%; padding: 15px; border-radius: 15px; background: var(--bg); box-shadow: var(--inner-shadow); border: none; outline: none; margin-bottom: 15px; height: 100px; }

        #loading { text-align: center; padding: 20px; font-weight: bold; color: var(--p); }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="splash"><div class="oren-reveal">OREN PRO</div></div>

    <div id="authPage">
        <h1 style="color: var(--p); font-weight: 900; letter-spacing: 2px;">OREN</h1>
        <div class="glass-card" style="width: 85%;">
            <input type="email" id="lEmail" class="input-box" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
            <input type="password" id="lPass" class="input-box" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            <button class="btn" onclick="login()">Ø¯Ø®ÙˆÙ„ Ø¢Ù…Ù† ğŸ”“</button>
        </div>
        <p onclick="showAdmin()" style="margin-top: 20px; font-size: 12px; opacity: 0.5; cursor: pointer;">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</p>
    </div>

    <div id="dashboard">
        <div class="glass-card top-bar">
            <div class="user-info">
                <span>Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒØŒ</span><br>
                <b id="uName">Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</b>
            </div>
            <button onclick="logout()" style="border:none; background:none; color:red; font-weight:bold;">Ø®Ø±ÙˆØ¬ ğŸšª</button>
        </div>

        <div class="stats-grid">
            <div class="stat-item">
                <span class="stat-num" id="uDone">0</span>
                <span class="stat-label">Ù…Ù‡Ø§Ù… Ù…ÙƒØªÙ…Ù„Ø©</span>
            </div>
            <div class="stat-item">
                <span class="stat-num" id="uWait">0</span>
                <span class="stat-label">Ù…Ù‡Ø§Ù… Ù‚Ø§Ø¯Ù…Ø©</span>
            </div>
        </div>

        <div id="taskContainer">
            <div class="task-card">
                <span class="task-tag">Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© âš¡</span>
                <span class="client-name" id="cName">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ù‡Ø§Ù…...</span>
                
                <div class="info-row">ğŸ“ <b>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</b> <span id="cAddr">--</span></div>
                <div class="info-row">ğŸ“ <b>ØªÙ„ÙŠÙÙˆÙ†:</b> <span id="cPhone">--</span></div>
                <div class="info-row">ğŸ“ <b>Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:</b> <span id="cDesc">--</span></div>

                <textarea id="visitReport" class="report-area" placeholder="Ø§ÙƒØªØ¨ ØªÙ‚Ø±ÙŠØ±Ùƒ Ù‡Ù†Ø§ Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ù‡Ù…Ø©..."></textarea>
                <button class="btn" onclick="finishTask()" style="background: var(--p); color: white;">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙˆØ¥Ù†Ù‡Ø§Ø¡ âœ…</button>
            </div>
        </div>

        <div id="noTasks" class="glass-card hidden" style="text-align: center; padding: 50px;">
            <p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ø­Ø§Ù„ÙŠØ§Ù‹. Ø§Ø³ØªÙ…ØªØ¹ Ø¨ÙˆÙ‚ØªÙƒ! ğŸ˜</p>
        </div>
    </div>

    <div id="adminPanel" class="hidden" style="padding: 20px;">
        <div class="glass-card">
            <h2 style="color: var(--p);">Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
            <input type="text" id="mUid" class="input-box" placeholder="UID Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨">
            <input type="text" id="mClient" class="input-box" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
            <input type="text" id="mAddress" class="input-box" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†">
            <input type="text" id="mPhone" class="input-box" placeholder="Ø§Ù„ØªÙ„ÙŠÙÙˆÙ†">
            <textarea id="mDesc" class="input-box" style="height:70px" placeholder="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø©"></textarea>
            <button class="btn" onclick="sendTask()">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø·Ø§Ø¨ÙˆØ± ğŸš€</button>
            <button class="btn" onclick="location.reload()" style="margin-top: 15px; color: red;">Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, push, set, get, update, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyALgV2v3lmxvEoP0HosqGSqm727vZrYUq4",
            authDomain: "orenapp-f2f1e.firebaseapp.com",
            databaseURL: "https://orenapp-f2f1e-default-rtdb.firebaseio.com",
            projectId: "orenapp-f2f1e",
            storageBucket: "orenapp-f2f1e.firebasestorage.app",
            messagingSenderId: "973368909449",
            appId: "1:973368909449:web:ce364a309f622f575c3058"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        let userUid = null;
        let currentTaskId = null;

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø© (Ø¹Ø´Ø§Ù† Ø§Ù„Ø±ÙŠÙØ±ÙŠØ´)
        onAuthStateChanged(auth, (user) => {
            if (user) {
                userUid = user.uid;
                document.getElementById('authPage').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                loadTasks();
            } else {
                document.getElementById('authPage').style.display = 'flex';
                document.getElementById('dashboard').style.display = 'none';
            }
            hideSplash();
        });

        window.login = async () => {
            const e = document.getElementById('lEmail').value;
            const p = document.getElementById('lPass').value;
            try { await signInWithEmailAndPassword(auth, e, p); } catch { alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"); }
        };

        window.logout = () => signOut(auth);

        window.showAdmin = () => {
            if(prompt("Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø§Ù„Ù…Ø¯ÙŠØ±:") === "123456") {
                document.getElementById('authPage').style.display = 'none';
                document.getElementById('adminPanel').classList.remove('hidden');
            }
        };

        function loadTasks() {
            // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…Ù‡Ø§Ù…
            onValue(ref(db, 'tasks/' + userUid), (snapshot) => {
                const tasks = snapshot.val();
                let pendingTasks = [];
                if(tasks) {
                    pendingTasks = Object.keys(tasks).filter(key => tasks[key].status === "pending").sort();
                }

                document.getElementById('uWait').innerText = pendingTasks.length;
                
                if(pendingTasks.length > 0) {
                    const firstId = pendingTasks[0];
                    const task = tasks[firstId];
                    currentTaskId = firstId;
                    document.getElementById('cName').innerText = task.client;
                    document.getElementById('cAddr').innerText = task.address;
                    document.getElementById('cPhone').innerText = task.phone;
                    document.getElementById('cDesc').innerText = task.desc;
                    document.getElementById('taskContainer').classList.remove('hidden');
                    document.getElementById('noTasks').classList.add('hidden');
                } else {
                    document.getElementById('taskContainer').classList.add('hidden');
                    document.getElementById('noTasks').classList.remove('hidden');
                }
            });

            // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…ÙƒØªÙ…Ù„
            onValue(ref(db, 'history/' + userUid), (snapshot) => {
                document.getElementById('uDone').innerText = snapshot.exists() ? Object.keys(snapshot.val()).length : 0;
            });
        }

        window.finishTask = async () => {
            const report = document.getElementById('visitReport').value;
            if(!report) return alert("Ø§ÙƒØªØ¨ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø£ÙˆÙ„Ø§Ù‹");

            const historyRef = push(ref(db, 'history/' + userUid));
            await set(historyRef, {
                client: document.getElementById('cName').innerText,
                report: report,
                time: new Date().toLocaleString('ar-EG')
            });

            await update(ref(db, 'tasks/' + userUid + '/' + currentTaskId), { status: "completed" });
            document.getElementById('visitReport').value = "";
            alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙˆØ³Ø­Ø¨ Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©!");
        };

        window.sendTask = async () => {
            const uid = document.getElementById('mUid').value;
            const client = document.getElementById('mClient').value;
            if(!uid || !client) return alert("Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
            
            const newTaskRef = push(ref(db, 'tasks/' + uid));
            await set(newTaskRef, {
                client: client,
                address: document.getElementById('mAddress').value,
                phone: document.getElementById('mPhone').value,
                desc: document.getElementById('mDesc').value,
                status: "pending"
            });
            alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø© Ù„Ù„Ø·Ø§Ø¨ÙˆØ±!");
            ["mClient", "mAddress", "mPhone", "mDesc"].forEach(id => document.getElementById(id).value = "");
        };

        function hideSplash() {
            setTimeout(() => {
                document.getElementById('splash').style.opacity = '0';
                setTimeout(() => document.getElementById('splash').style.display = 'none', 500);
            }, 2000);
        }
    </script>
</body>
</html>
